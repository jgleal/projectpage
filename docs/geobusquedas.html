<h2>Geobúsquedas</h2>

<ul class="nav nav-pills">
    <li class="nav-item"><a class="nav-link active" data-toggle="pill" href="#escenario">Escenario</a></li>
    <li class="nav-item"><a class="nav-link" data-toggle="pill" href="#descripcion">Descripción</a></li>
    <li class="nav-item"><a class="nav-link" data-toggle="pill" href="#uso">Uso</a></li>
</ul>

<div class="tab-content">
    <!-- Tab de Escenario -->
    <div id="escenario" class="tab-pane active" role="tabpanel">
        <p>El uso de estádares para la difusión de información espacial está ampliamente extendido hoy en día. Además del acceso, permiten la consulta 
            de datos específicos en base a criterios de búsquedas.
        </p>
        <p>
            Sin embargo, las búsquedas de información espacial realizadas a través de estándares <b>suelen requerir que el usuario conozca la 
            estructura interna de la misma</b>. Por ejemplo, la siguiente consulta utiliza un filtro CQL para buscar por su nombre un fenómeno espacial 
            o feature de tipo "parque" a través de una petición a un servicio WFS por el que se publica la capa correspondiente:
            <p class="bg-light">
<pre lang="xml"><code>
&lt;wfs:GetFeature version="1.1.0"&gt;
 &lt;wfs:Query <b>typeName="espacios:Parques"</b>&gt;
    &lt;ogc:Filter&gt;
        &lt;ogc:PropertyIsEqualTo&gt;
            &lt;ogc:PropertyName&gt;<b>nombre_parq</b>&lt;/ogc:PropertyName&gt;
                &lt;ogc:Literal&gt;<b>Alamillo</b>&lt;/ogc:Literal&gt;
        &lt;/ogc:PropertyIsEqualTo&gt;
    &lt;/ogc:Filter&gt;
&lt;/wfs:Query&gt;
&lt;/wfs:GetFeature&gt; 
</code></pre>
            </p>
            <p>Puede observarse como es necesario especificar no solo el nombre por el que se busca, sino <b>también el de la propiedad 
               que lo contiene, 'nombre_parq'</b>. Además, la consulta debe ejecutarse específicamente contra la capa en cuestión, indicada en el 
                <i>typeName</i>.
            </p>
            <p>Un usuario externo no posee dicha información. El objetivo es que pueda realizar las búsquedas mediante lenguaje natural, es decir, especificando 
                únicamente un nombre, palabra o frase.
            </p>
        </p>
    </div>

    <!-- Tab de Descripcion -->
    <div id="descripcion" class="tab-pane" role="tabpanel">
        <p><b>Geobúsquedas</b> es el nombre que recibe la instancia centralizada de <a href="http://lucene.apache.org/solr/" target="_blank">Apache SOLR</a> del SIGCorporativo, a la que se le ha añadido una serie de 
            funcionalidades que faciliten la indexación y búsqueda de información espacial, tales como:
        </p>
        <ul>
            <li>Indexación de servicios WFS con paginación automática de peticiones cuando hay límite en el número de features devueltos.</li>
            <li>Indexación de tablas Postgresql/Postgis.</li>
            <li>Tesauros espaciales predefinidos para consultas de relación entre elementos: en, cerca de, próximo, etc.</li>
            <li>Parámetros de búsquedas espaciales: "srs" para especificar el sistema de referencia de las geometrías devueltas, "pt" para 
                búsquedas centradas en un punto, entre otros.
            </li>
        </ul>
        <p>De esta manera, cada core de Geobúsquedas contiene la información indexada de uno o varios servicios WFS. Una vez configurados internamente, 
            los elementos espaciales pueden buscarse mediante consultas en lenguaje natural, por los valores de sus atributos o <b>mediante relaciones espaciales 
            entre ellos</b>. 
        </p>

        <img width="70%" class="center" src="./img/geobusquedas.png" alt="Geobúsquedas">

        <p>Para indexar tu información necesitas por tanto:</p>
        <ul>
            <li>Servicios WFS para las capas que contengan los elementos que puedan buscarse mediante lenguaje natural.</li>
            <li>Tener claro qué tipo de búsquedas quieres: por qué atributos poder buscar, cuáles mostrar en los resultados, qué importancia o peso tiene 
                cada uno, etc. </li>
            <li>Decidir qué otras capas pueden actuar como referencia espacial: divisiones administrativas, espacios naturales,... </li>
        </ul>
    </div>
    <!-- Tab de Uso -->
    <div id="uso" class="tab-pane" role="tabpanel">

            <p>Una vez indexada la información, para consumir el servicio existen dos opciones:<br>
             <ul>
                <li>Pueden realizarse las consultas directamente a través del api REST <br>
                    <a href="http://geobusquedas-sigc.juntadeandalucia.es/geobusquedas/sigc/search?q=colegios+en+Tomares&wt=json&indent=true" target="_blank">
                        <code>http://geobusquedas-sigc.juntadeandalucia.es/geobusquedas/sigc/search?q=colegios+en+Tomares&wt=json&indent=true</code></a>
                </li>
                <li>También pueden realizarse las búsquedas mediante el plugin de Mapea creado específicamente para ello:</li>
            </ul>
            <div id="divmapgeobusquedas" style="width:75%;box-sizing: unset !important;position: relative;left:12%" class="m-container"></div>
            
    
        </div>
</div>

<script lang="javascript">

        var mapajs = null;
        $('.nav-pills a[href="#uso"]').on('shown.bs.tab', function (e) {
           if (!mapajs){ 
                mapajs = M.map({
                    container: 'divmapgeobusquedas',
                    controls: ['scale','panzoombar'],
                    wmcfiles: ['https://mapea4-sigc.juntadeandalucia.es/files/wmc/cdau.xml*Callejero','https://mapea4-sigc.juntadeandalucia.es/files/wmc/satelite.xml*Satelite']
                });
                let p = new M.plugin.Geosearch({
                "core": "sigc",
                "url": "http://geobusquedas-sigc.juntadeandalucia.es/",
                "handler": "/search"
                });
                
                mapajs.addPlugin(p);
                mapajs.getControls('geosearch')[0].on(M.evt.ADDED_TO_MAP, function(){
                        mapajs.getPanels('geosearch')[0].open();
                        document.getElementById('m-geosearch-search-input').value = "Colegios en Tomares";
                        document.getElementById('m-geosearch-search-btn').click();
                })
            }
        });
    
    
        
    </script>